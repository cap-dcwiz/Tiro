
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-8.5.10">
    
    
      
        <title>Karez Integration - Tiro Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/code_select.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#karez-integration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tiro Documentation" class="md-header__button md-logo" aria-label="Tiro Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tiro Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Karez Integration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cap-dcwiz/Tiro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    cap-dcwiz/Tiro
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../" class="md-tabs__link md-tabs__link--active">
      Get Started
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../topics/scenario_from_snapshot/" class="md-tabs__link">
        Topics
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../background/motivation/" class="md-tabs__link">
        Background
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../license/" class="md-tabs__link">
      License
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://github.com/cap-dcwiz/Tiro-asset-library" class="md-tabs__link">
      Tiro Assets Library
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tiro Documentation" class="md-nav__button md-logo" aria-label="Tiro Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Tiro Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cap-dcwiz/Tiro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    cap-dcwiz/Tiro
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Get Started</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Get Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Get Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scenario/" class="md-nav__link">
        Scenario
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic_tools/" class="md-nav__link">
        Basic Tools
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Karez Integration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Karez Integration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directory-setup" class="md-nav__link">
    Directory Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mock-server" class="md-nav__link">
    Mock Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#karez-collector" class="md-nav__link">
    Karez Collector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#karez-validator" class="md-nav__link">
    Karez Validator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-persistence" class="md-nav__link">
    Data Persistence
  </a>
  
    <nav class="md-nav" aria-label="Data Persistence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    Preprocessing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#influxdb" class="md-nav__link">
    InfluxDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arangodb" class="md-nav__link">
    ArangoDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utinni_integration/" class="md-nav__link">
        Utinni Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Topics" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/scenario_from_snapshot/" class="md-nav__link">
        Scenario from Snapshot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/data_collection_protocol/" class="md-nav__link">
        Data Collection Protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/utinni_querying_guide/" class="md-nav__link">
        Utinni Querying Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/asset_library/" class="md-nav__link">
        Asset Library
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Background
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Background" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Background
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../background/motivation/" class="md-nav__link">
        Motivation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../background/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../background/materials/" class="md-nav__link">
        Materials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../reference/">Reference</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/cap-dcwiz/Tiro-asset-library" class="md-nav__link">
        Tiro Assets Library
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/cap-dcwiz/Tiro/blob/main/docs/get_started/karez_integration.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="karez-integration">Karez Integration<a class="headerlink" href="#karez-integration" title="Permanent link">&para;</a></h1>
<p>We have developed a data collection framework for DCWiz called <a href="https://github.com/cap-dcwiz/Karez">Karez</a>. Tiro provides deep integration with Karez. In this section, we will show how to use Tiro and Karaz together to build the complete data collection and processing workflow for a IoT system.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Karez should already be declared as a dependency of <strong>Tiro</strong>. Thus, you do not need to install Karez separately. </p>
<p>However, before we start, we still need to set up <a href="https://www.influxdata.com/products/influxdb-overview/">InfluxDB</a> and <a href="https://www.arangodb.com/">ArangoDB</a>. Tiro uses InfluxDB to store the collected telemetries for assets and uses ArangoDB to store the attributes and relationships of the assets.</p>
<p>To simplify the setup process, we will use <a href="https://docs.docker.com/compose/">Docker Compose</a> to start the two databases and the Karez components. Please refer to the <a href="https://docs.docker.com/compose/install/">Docker documentation</a> to install Docker Compose.</p>
<p>Let's create a file named <code>docker-compose.yml</code> with the following content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">docker-compose.yml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.9&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">influxdb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb:alpine</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086:8086</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">DOCKER_INFLUXDB_INIT_MODE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup</span>
<span class="w">      </span><span class="nt">DOCKER_INFLUXDB_INIT_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro</span>
<span class="w">      </span><span class="nt">DOCKER_INFLUXDB_INIT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro-password</span>
<span class="w">      </span><span class="nt">DOCKER_INFLUXDB_INIT_ORG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro</span>
<span class="w">      </span><span class="nt">DOCKER_INFLUXDB_INIT_BUCKET</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro</span>
<span class="w">      </span><span class="nt">DOCKER_INFLUXDB_INIT_ADMIN_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro-token</span>

<span class="w">  </span><span class="nt">arangodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arangodb/arangodb:3.8.6</span>
<span class="w">    </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux/amd64</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8529:8529</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">ARANGO_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro-password</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arangod --server.endpoint tcp://0.0.0.0:8529</span>

<span class="w">  </span><span class="nt">nats-server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nats</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4222:4222</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8222:8222</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>In the following subsections, we will set up following components:</p>
<ol>
<li>A mock server to generate mock data;</li>
<li>A set of Karez roles to collect the mock data;</li>
<li>A set of Karez roles to transform the mock data;</li>
<li>A validator to validate the collected data;</li>
<li>A set of Karez roles to persist the collected data in databases.</li>
</ol>
<p>The complete source code of the example can be found under the <code>example/karez</code> directory of the Tiro repository.</p>
<h2 id="directory-setup">Directory Setup<a class="headerlink" href="#directory-setup" title="Permanent link">&para;</a></h2>
<p>Let's create a directory named <code>karez</code> and follow the following steps to set up the directory structure and initial files:</p>
<ol>
<li>Create a sub-directory name <code>scenario</code> to store the scenario files. After that, copy the <code>scenario.yaml</code>, <code>use-srv1.yaml</code> and <code>use-srv2.yaml</code> into this directory. </li>
<li>Create subdirectory named <code>karez</code> and create four subdirectories named <code>dispatcher</code>, <code>connector</code>, <code>converter</code> and <code>aggregator</code> in the <code>karez</code> directory. We will use these directories to arrange Karez roles.</li>
<li>Create a subdirectory named <code>config</code> to store various configuration files. </li>
<li>Create a file named <code>karez.yml</code> in <code>config</code> directory. This file will be used to configure the Karez components.</li>
<li>Copy the just created <code>docker-compose.yml</code> into the <code>karez</code> directory and run the following command to start the databases and Karez components:</li>
</ol>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--build
</code></pre></div>
<h2 id="mock-server">Mock Server<a class="headerlink" href="#mock-server" title="Permanent link">&para;</a></h2>
<p>Run the following command to create a mock server:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>tiro<span class="w"> </span>mock<span class="w"> </span>serve<span class="w"> </span>scenario/scenario.yaml<span class="w"> </span>scenario/use-srv1.yaml<span class="w"> </span>scenario/use-srv2.yaml
</code></pre></div>
<p>Alternative, you can also add the following section to the <code>docker-compose.yml</code> file </p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">docker-compose.yml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="nt">mock-server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/cap-dcwiz/tiro</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./scenario:/tiro/scenario</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test-assets.py:/tiro/test-assets.p</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro mock serve scenario/scenario.yaml scenario/use-srv1.yaml scenario/use-srv2.yaml -h 0.0.0.0</span>
</code></pre></div>
</div>
</div>
</div>
<p>After that, you need to run <code>docker-compose up -d</code> to start the mock server.</p>
<h2 id="karez-collector">Karez Collector<a class="headerlink" href="#karez-collector" title="Permanent link">&para;</a></h2>
<p>Here, we will config Karez to collect data point from the mock server. Tiro provides a <em>connector</em> plugin <code>ConnectorForMockServer</code> and a <em>dispatcher</em> plugin <code>DispatcherForMockServer</code> to collect data from the mock server. We will use these two plugins to collect data from the mock server.</p>
<p>First, let's add a <code>tiro_mock.py</code> file to the <code>karez/connector</code> directory with the following content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">karez/connector/tiro_mock.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tiro.plugins.karez</span> <span class="kn">import</span> <span class="n">ConnectorForMockServer</span> <span class="k">as</span> <span class="n">Connector</span>
</code></pre></div>
</div>
</div>
</div>
<p>And add another <code>tiro_mock.py</code> file to the <code>karez/dispatcher</code> directory with the following content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">karez/dispatcher/tiro_mock.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tiro.plugins.karez</span> <span class="kn">import</span> <span class="n">DispatcherForMockServer</span> <span class="k">as</span> <span class="n">Dispatcher</span>
</code></pre></div>
</div>
</div>
</div>
<p>After that, let's add the following section to the <code>karez.yaml</code> file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="nt">dispatchers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_mock</span>
<span class="w">    </span><span class="nt">connector</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_mock</span>
<span class="w">    </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
<span class="w">    </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">burst</span>
<span class="w">    </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8000</span>

<span class="nt">connectors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_mock</span>
<span class="w">    </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8000</span>
<span class="w">    </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
</code></pre></div>
</div>
</div>
</div>
<p>Run the following command to varify the configuration:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>karez<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-c<span class="w"> </span>config/karez.yaml<span class="w"> </span>-p<span class="w"> </span>karez/<span class="w"> </span>-d<span class="w"> </span>tiro_mock<span class="w"> </span>-n<span class="w"> </span>tiro_mock
<span class="go">{</span>
<span class="go">    &#39;path&#39;: &#39;DataHall.data_hall_0.CRAC.crac_0.Telemetry.ReturnTemperature&#39;,</span>
<span class="go">    &#39;result&#39;: {&#39;value&#39;: 38.15, &#39;timestamp&#39;: &#39;2022-09-27T10:32:38.364195&#39;},</span>
<span class="go">    &#39;_karez&#39;: {&#39;category&#39;: &#39;telemetry&#39;}</span>
<span class="go">}</span>
</code></pre></div>
<p>If you see similar output, it means the configuration is correct. Otherwise, you may use the <code>-d</code> or <code>-n</code> option to varify the configuration of a specific dispatcher or connector.</p>
<h2 id="karez-validator">Karez Validator<a class="headerlink" href="#karez-validator" title="Permanent link">&para;</a></h2>
<p>Tiro provides an <em>aggregator</em> plugin <code>ValidationAggregator</code> to validate the collected data. Now let's validate our collected data using this plugin. </p>
<p>First, let's add a <code>tiro_validate.py</code> file to the <code>karez/aggregator</code> directory with the following content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">karez/aggregator/tiro_validate.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tiro.plugins.karez</span> <span class="kn">import</span> <span class="n">ValidationAggregator</span> <span class="k">as</span> <span class="n">Aggregator</span>
</code></pre></div>
</div>
</div>
</div>
<p>After that, let's add the following section to the <code>karez.yaml</code> file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="nt">converters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update_category_for_validator</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter_and_update_meta</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">category</span>
<span class="w">    </span><span class="nt">rename</span><span class="p">:</span>
<span class="w">      </span><span class="nt">telemetry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validation_data</span>
<span class="w">      </span><span class="nt">attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validation_data</span>

<span class="nt">aggregators</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_validate</span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validation_data</span>
<span class="w">    </span><span class="nt">scenario</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scenario/scenario.yaml</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;scenario/use-srv1.yaml,scenario/use-srv2.yaml&quot;</span>
<span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">log_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validation.log</span>
</code></pre></div>
</div>
</div>
</div>
<p>Also, add the highlighted lines to the <code>connectors - tiro_mock</code> section:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="nt">connectors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_mock</span>
<span class="w">    </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8000</span>
<span class="w">    </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
<span class="hll"><span class="w">    </span><span class="nt">converters</span><span class="p">:</span>
</span><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update_category_for_validator</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>With the above configuration, we have set up a validation aggregator listening on the <code>validation_data</code> category. The validation aggregator will validate the collected data against the scenario files <code>scenario/scenario.yaml</code>, <code>scenario/use-srv1.yaml</code> and <code>scenario/use-srv2.yaml</code>. The validation result will be stored in the <code>validation.log</code> file as well as printed to the console. The validation will be executed every 10 seconds, using the last 10 seconds of data.</p>
<p>Now, we can deploy the Karez workflow by running the following command:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>karez<span class="w"> </span>deploy<span class="w"> </span>-c<span class="w"> </span>config/karez.yaml<span class="w"> </span>-p<span class="w"> </span>karez/
</code></pre></div>
<p>Wait for around 10 seconds, and you will see the validation result printed to the console:</p>
<div class="language-console highlight"><pre><span></span><code><span class="go">[KAREZ] Configurations: [&#39;config/karez.yaml&#39;].</span>
<span class="go">[KAREZ] NATS address: nats://localhost:4222.</span>
<span class="go">[KAREZ] Launched 1 Converters.</span>
<span class="go">[KAREZ] Launched 1 Connectors.</span>
<span class="go">[KAREZ] Launched 1 Dispatchers.</span>
<span class="go">[KAREZ] Launched 1 Aggregators.</span>
<span class="go"> Collection size: 11</span>
<span class="go">{</span>
<span class="go">  &quot;start&quot;: &quot;2022-09-27T11:39:24.255426&quot;,</span>
<span class="go">  &quot;end&quot;: &quot;2022-09-27T11:39:34.255426&quot;,</span>
<span class="go">  &quot;valid&quot;: true,</span>
<span class="go">  &quot;exception&quot;: null</span>
<span class="go">}</span>
</code></pre></div>
<p>The above result means the collected data is valid. If the collected data is invalid, the <code>valid</code> field will be set to <code>false</code> and the <code>exception</code> field will contain the error message. Meanwhile, the validation will be written to the <code>validation.log</code> file as well.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because currently we are using the mocking service, which always produce corrent data, the validation result will always be <code>true</code>. In a real environment, we can simply replace the dispatcher and connector with the real service, and the validation will be performed on the real data. This provides a way to validate the real data collection process.</p>
</div>
<h2 id="data-persistence">Data Persistence<a class="headerlink" href="#data-persistence" title="Permanent link">&para;</a></h2>
<p>Now, let's add more Karez roles to persist the collected data. Tiro stores the data in both InfluxDB and ArangoDB, where the former is used to store the time series data and the latter is used to store static attributes and relationships.</p>
<h3 id="preprocessing">Preprocessing<a class="headerlink" href="#preprocessing" title="Permanent link">&para;</a></h3>
<p>Before storing the data to databases, some preprocessing is needed to convert data format and add some metadata. Tiro provides a <em>converter</em> plugin <code>TiroPreprocessConverter</code> to do these. First, let's add a <code>tiro_preprocess.py</code> file to the <code>karez/converter</code> directory with the following content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">kalrez/converter/tiro_preprocess.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tiro.plugins.karez</span> <span class="kn">import</span> <span class="n">TiroPreprocessConverter</span> <span class="k">as</span> <span class="n">Converter</span>
</code></pre></div>
</div>
</div>
</div>
<p>Then, add the following content in the <code>converters</code> section of the <code>karez.yaml</code> file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_preprocess</span>
<span class="w">    </span><span class="nt">tz_infos</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SGT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Aisa/Singapore</span>
<span class="w">    </span><span class="nt">next</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influx_line_protocol</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update_category_for_arangodb</span>
</code></pre></div>
</div>
</div>
</div>
<p>Also, we need to add the convertor into the processing pipeline by adding the following highlighted line to the <code>connectors - tiro_mock</code> section:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="nt">connectors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_mock</span>
<span class="w">    </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8000</span>
<span class="w">    </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path</span>
<span class="w">    </span><span class="nt">converter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update_category_for_validator</span>
<span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_preprocess</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>We can run the following command to test the configuration:</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>karez<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-c<span class="w"> </span>config/karez.yaml<span class="w"> </span>-p<span class="w"> </span>karez/<span class="w"> </span>-d<span class="w"> </span>tiro_mock<span class="w"> </span>-n<span class="w"> </span>tiro_mock<span class="w"> </span>-v<span class="w"> </span>tiro_preprocess
<span class="go">{</span>
<span class="go">    &#39;path&#39;: &#39;DataHall.CRAC.ReturnTemperature&#39;,</span>
<span class="go">    &#39;asset_path&#39;: &#39;DataHall.data_hall_0.CRAC.crac_0&#39;,</span>
<span class="go">    &#39;DataHall&#39;: &#39;data_hall_0&#39;,</span>
<span class="go">    &#39;CRAC&#39;: &#39;crac_0&#39;,</span>
<span class="go">    &#39;type&#39;: &#39;Telemetry&#39;,</span>
<span class="go">    &#39;field&#39;: &#39;ReturnTemperature&#39;,</span>
<span class="go">    &#39;value&#39;: 23.84,</span>
<span class="go">    &#39;timestamp&#39;: 1664251882.666721</span>
<span class="go">}</span>
</code></pre></div>
<h3 id="influxdb">InfluxDB<a class="headerlink" href="#influxdb" title="Permanent link">&para;</a></h3>
<p>We will use <a href="https://www.influxdata.com/time-series-platform/telegraf/">Telegraf</a> to send the data to InfluxDB. First, let add the following service in the <code>docker-compose.yml</code> file:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">docker-compose.yml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="nt">telegraf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telegraf</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/telegraf.conf:/etc/telegraf/telegraf.conf</span>
</code></pre></div>
</div>
</div>
</div>
<p>Then, let's add a <code>telegraf.conf</code> file with the following content in the <code>config</code> directory:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">config/telegraf.conf</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span class="k">[[outputs.influxdb_v2]]</span>
<span class="w"> </span><span class="n">urls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;http://localhost:8086&quot;</span><span class="p">]</span>
<span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tiro-token&quot;</span>
<span class="w"> </span><span class="n">organization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tiro&quot;</span>
<span class="w"> </span><span class="n">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tiro&quot;</span>

<span class="k">[[inputs.nats_consumer]]</span>
<span class="w">  </span><span class="n">servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;nats://localhost:4222&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="n">subjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;karez.telemetry.&gt;&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="n">queue_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;karez_telegraf&quot;</span>
<span class="w">  </span><span class="n">data_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;influx&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<p>The above configuration tells Telegraf to listen on the <code>karez.telemetry.*</code> subject and send the data to InfluxDB. After adding/modifying the configuration, you need to run <code>docker-compose up -d</code> to update the services.</p>
<p>Now, let's add the following converter in the <code>converters</code> sections of <code>karez.yaml</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influx_line_protocol</span>
<span class="w">    </span><span class="nt">measurement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro_telemetry</span>
<span class="w">    </span><span class="nt">field_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">field</span>
<span class="w">    </span><span class="nt">field_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value</span>
</code></pre></div>
</div>
</div>
</div>
<p>This converter translates the preprocessed data into the InfluxDB line protocol format. The <code>measurement</code> field specifies the measurement name, and the <code>field_name</code> and <code>field_value</code> fields specify the columns that will be used as field and value in the line protocol.</p>
<h3 id="arangodb">ArangoDB<a class="headerlink" href="#arangodb" title="Permanent link">&para;</a></h3>
<p>Tiro also provides an <em>aggregator</em> plugin <code>ArangoAggregator</code> to store the data to ArangoDB. First, let's add a <code>arango_db.py</code> file to the <code>karez/aggregator</code> directory with the following content:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">karez/aggregator/arango_db.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tiro.plugins.karez</span> <span class="kn">import</span> <span class="n">ArangoAggregator</span> <span class="k">as</span> <span class="n">Aggregator</span>
</code></pre></div>
</div>
</div>
</div>
<p>Then, to avoid confusing the data with those sending to InfluxDB and validator, we added another converter to mark the data as <code>graph_data</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update_category_for_arangodb</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter_and_update_meta</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">category</span>
<span class="w">    </span><span class="nt">rename</span><span class="p">:</span>
<span class="w">      </span><span class="nt">telemetry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">graph_data</span>
<span class="w">      </span><span class="nt">attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">graph_data</span>
</code></pre></div>
</div>
</div>
</div>
<p>After that, we can add the following aggregator in the <code>aggregators</code> section of <code>karez.yaml</code>:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:1"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">config/karez.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-yaml highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arango_db</span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">graph_data</span>
<span class="w">    </span><span class="nt">scenario</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scenario/scenario.yaml</span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;scenario/use-srv1.yaml,scenario/use-srv2.yaml&quot;</span>
<span class="w">    </span><span class="nt">db_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro</span>
<span class="w">    </span><span class="nt">graph_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scenario</span>
<span class="w">    </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:8529</span>
<span class="w">    </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiro-password</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<p>Now, we can re-deploy the Karez service to start the data persistence process.</p>
<div class="language-console highlight"><pre><span></span><code><span class="gp">$ </span>karez<span class="w"> </span>deploy<span class="w"> </span>-c<span class="w"> </span>config/karez.yaml<span class="w"> </span>-p<span class="w"> </span>karez/
<span class="go">[KAREZ] Configurations: [&#39;config/karez.yaml&#39;].</span>
<span class="go">[KAREZ] NATS address: nats://localhost:4222.</span>
<span class="go">[KAREZ] Launched 4 Converters.</span>
<span class="go">[KAREZ] Launched 1 Connectors.</span>
<span class="go">[KAREZ] Launched 1 Dispatchers.</span>
<span class="go">[KAREZ] Launched 2 Aggregators.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We can also include the karez workflow and mock service in <code>docker-compose.yml</code> to deploy them together. In that case, remember to change different hostnames corresponding to the services.</p>
</div>
<p>Now, one should be able to access <a href="http://localhost:8086">http://localhost:8086</a> to see the data in InfluxDB or access <a href="http://localhost:8529">http://localhost:8529</a> to see the data in ArangoDB.</p>
<p>In next section, we will show how to use <a href="" title="https://github.com/cap-dcwiz/Utinni">Utinni</a> to access the data easily.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../basic_tools/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basic Tools" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Basic Tools
            </div>
          </div>
        </a>
      
      
        
        <a href="../utinni_integration/" class="md-footer__link md-footer__link--next" aria-label="Next: Utinni Integration" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Utinni Integration
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.instant", "navigation.expand", "navigation.indexes", "navigation.prune", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="../../javascripts/tablesort.js"></script>
      
    
    
  </body>
</html>